# Voicer 项目架构文档

## 概述

Voicer 是一个基于 Vue 3 + TypeScript + Tauri 构建的桌面应用程序，提供语音识别和 AI 聊天功能。应用采用现代前端技术栈，支持跨平台部署。

## 技术栈

### 前端
- **Vue 3** - 渐进式 JavaScript 框架
- **TypeScript** - 类型安全的 JavaScript 超集
- **Vite** - 下一代前端构建工具
- **Naive UI** - Vue 3 组件库
- **Pinia** - Vue 状态管理库
- **Vue Router** - 路由管理

### 后端/桌面端
- **Tauri** - 使用 Rust 构建小型、快速、安全的桌面应用
- **Rust** - 系统级编程语言

### 开发工具
- **Playwright** - 端到端测试框架
- **ESLint** - 代码质量检查
- **Prettier** - 代码格式化

## 项目结构

```
voicer/
├── src/                    # 前端源代码
│   ├── assets/            # 静态资源
│   ├── components/        # Vue 组件
│   │   ├── ChatInterface.vue      # 聊天界面组件
│   │   ├── VoiceRecognition.vue   # 语音识别组件
│   │   ├── SettingsPanel.vue      # 设置面板组件
│   │   └── icons/                 # 图标组件
│   ├── stores/            # Pinia 状态管理
│   │   └── index.ts       # 应用状态管理
│   ├── router/            # 路由配置
│   │   └── index.ts       # 路由定义
│   ├── views/             # 页面视图
│   │   ├── HomeView.vue   # 主页视图
│   │   └── AboutView.vue  # 关于页面视图
│   ├── App.vue            # 根组件
│   └── main.ts            # 应用入口
├── src-tauri/             # Tauri 后端代码
│   ├── src/               # Rust 源代码
│   │   ├── lib.rs         # 库入口
│   │   └── main.rs        # 应用入口
│   ├── Cargo.toml         # Rust 依赖配置
│   └── tauri.conf.json    # Tauri 应用配置
├── public/                # 公共静态文件
├── e2e/                   # 端到端测试
├── docs/                  # 项目文档
└── 配置文件
    ├── package.json       # Node.js 依赖和脚本
    ├── vite.config.ts     # Vite 配置
    ├── tsconfig.json      # TypeScript 配置
    └── playwright.config.ts # Playwright 配置
```

## 核心组件

### 1. ChatInterface.vue
- **功能**: 提供聊天界面，包括消息显示、输入框、发送按钮
- **特性**:
  - 消息列表显示（用户消息和 AI 回复）
  - 消息发送状态指示（发送中、成功、失败）
  - 错误处理和重试机制
  - 自动滚动到底部
  - 移动端适配

### 2. VoiceRecognition.vue
- **功能**: 语音识别组件，支持语音转文字
- **特性**:
  - 基于 Web Speech API 的语音识别
  - 实时识别结果显示
  - 录音状态指示
  - 多语言支持（默认中文）
  - 自动发送选项

### 3. App Store (Pinia)
- **位置**: `src/stores/index.ts`
- **功能**: 全局状态管理
- **管理状态**:
  - 聊天消息列表
  - 加载状态和进度
  - 错误信息和类型
  - API 配置
  - 重试机制

## 数据流

1. **用户输入流程**:
   ```
   用户输入/语音 → ChatInterface → App Store → AI API → 响应处理 → 更新消息列表
   ```

2. **状态更新流程**:
   ```
   组件触发 Action → Store 更新 State → 组件响应式更新 UI
   ```

3. **错误处理流程**:
   ```
   发生错误 → Store 记录错误类型 → 组件显示错误信息 → 用户选择重试或继续
   ```

## 通信机制

### 前端内部通信
- **组件间通信**: Props/Events + Pinia Store
- **状态管理**: Pinia 提供集中式状态管理
- **路由管理**: Vue Router 处理页面导航

### 前后端通信 (Tauri)
- **命令调用**: 通过 `@tauri-apps/api` 调用 Rust 后端功能
- **事件系统**: Tauri 提供的事件发布/订阅机制
- **进程间通信**: 安全的前后端数据交换

## 设计模式

### 1. 组件化设计
- 每个功能模块封装为独立组件
- 遵循单一职责原则
- 组件间通过清晰的接口通信

### 2. 状态集中管理
- 使用 Pinia 集中管理应用状态
- 状态变更可预测、可追踪
- 便于调试和测试

### 3. 错误边界
- 组件级错误处理
- 全局错误捕获
- 用户友好的错误提示

### 4. 响应式设计
- 移动端优先的响应式布局
- 自适应不同屏幕尺寸
- 触摸友好的交互设计

## 性能考虑

### 1. 代码分割
- 路由级别的懒加载
- 组件按需加载
- 减少初始加载时间

### 2. 资源优化
- 图片和图标优化
- CSS 和 JavaScript 压缩
- 缓存策略

### 3. 渲染优化
- Vue 3 的组合式 API
- 响应式系统优化
- 虚拟滚动（消息列表）

## 安全性

### 1. 前端安全
- XSS 防护（Vue 自动转义）
- CSP 策略配置
- 输入验证和清理

### 2. Tauri 安全
- 进程隔离
- 权限控制
- 安全的 IPC 通信

### 3. API 安全
- API 密钥管理
- 请求签名
- 速率限制

## 扩展性

### 1. 插件系统
- 支持功能插件扩展
- 统一的插件接口
- 热插拔支持

### 2. 主题系统
- 多主题支持
- 动态主题切换
- 自定义主题配置

### 3. 国际化
- i18n 支持
- 多语言切换
- 本地化资源管理

## 部署架构

### 开发环境
- 本地开发服务器
- 热重载支持
- 开发工具集成

### 生产环境
- 静态资源构建
- 代码优化和压缩
- 跨平台打包（Windows、macOS、Linux）

## 监控和日志

### 1. 前端监控
- 错误追踪
- 性能监控
- 用户行为分析

### 2. 后端日志
- 结构化日志
- 日志级别控制
- 日志持久化

---

*最后更新: 2025-12-13*
